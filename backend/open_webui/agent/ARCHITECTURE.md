# Agent åŠŸèƒ½æ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
4. [èŠ‚ç‚¹ç±»å‹](#èŠ‚ç‚¹ç±»å‹)
5. [æ•°æ®æµ](#æ•°æ®æµ)
6. [API æ¥å£](#api-æ¥å£)
7. [å‰ç«¯é›†æˆ](#å‰ç«¯é›†æˆ)
8. [æ‰©å±•è®¡åˆ’](#æ‰©å±•è®¡åˆ’)

---

## æ¦‚è¿°

Agent æ¨¡å—æ˜¯åŸºäº **LangGraph** æ¡†æ¶çš„å·¥ä½œæµæ‰§è¡Œå¼•æ“ï¼Œç”¨äºå®ç°å¤æ‚çš„å¤šæ­¥éª¤ AI å·¥ä½œæµï¼Œæ”¯æŒï¼š
- âœ… å¤šèŠ‚ç‚¹å·¥ä½œæµï¼ˆè¾“å…¥ã€æ•°æ®æºã€æ£€ç´¢ã€LLMã€å·¥å…·ã€è¾“å‡ºï¼‰
- âœ… åŸºäº LangGraph StateGraph çš„å›¾æ‰§è¡Œ
- âœ… çŠ¶æ€ç®¡ç†å’Œæ¶ˆæ¯ä¼ é€’
- âœ… é›†æˆ OpenWebUI Tools ç³»ç»Ÿ
- âœ… æ¡ä»¶è·¯ç”±å’Œå¾ªç¯æ‰§è¡Œï¼ˆè§„åˆ’ä¸­ï¼‰
- âœ… æ—¶é—´ç»Ÿè®¡å’Œè°ƒè¯•æ”¯æŒ

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±‚ (Frontend)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Agent.svelte  (å·¥ä½œç©ºé—´é¢æ¿)                    â”‚   â”‚
â”‚  â”‚  +page.svelte  (è·¯ç”±é¡µé¢)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                        â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  agentAPI (TypeScript API Client)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯å±‚ (Backend)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  routers/agent.py (API è·¯ç”±)                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ /api/v1/agent/                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ /api/v1/agent/retrieval/                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€ /api/v1/agent/rag/                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                        â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  agent/ (æ ¸å¿ƒæ¨¡å—)                               â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ graph.py      (å›¾æ„å»ºå’Œæ‰§è¡Œ)                â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ nodes.py      (èŠ‚ç‚¹å®ç°)                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ state.py      (çŠ¶æ€å®šä¹‰)                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€ __init__.py   (æ¨¡å—å¯¼å‡º)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                        â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¤–éƒ¨æœåŠ¡é›†æˆ                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ RAGFlow (æ£€ç´¢æœåŠ¡)                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ LLM (OpenAI/æœ¬åœ°æ¨¡å‹)                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Tools (OpenWebUI Tools ç³»ç»Ÿ)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ InputNode â†’ DataSourceNode
                    â†“
              RetrievalNode (æ£€ç´¢)
                    â†“
              LLMNode (ç”Ÿæˆ)
                    â†“
              ToolNode (å¯é€‰å·¥å…·è°ƒç”¨)
                    â†“
              OutputNode (è¾“å‡º)
```

---

## æ ¸å¿ƒæ¨¡å—

### 1. `state.py` - çŠ¶æ€ç®¡ç†

**èŒè´£**: å®šä¹‰å·¥ä½œæµçŠ¶æ€ç»“æ„å’Œæ¶ˆæ¯æ ¼å¼

**æ ¸å¿ƒç±»**:
- `Message`: èŠ‚ç‚¹é—´ä¼ é€’çš„æ¶ˆæ¯
  ```python
  class Message(BaseModel):
      type: str  # "user", "context", "text", "json"
      payload: Any
  ```

- `WorkflowState`: å·¥ä½œæµå…¨å±€çŠ¶æ€
  ```python
  class WorkflowState(BaseModel):
      messages: Dict[str, Dict[str, Message]]  # èŠ‚ç‚¹ID -> ç«¯å£ -> æ¶ˆæ¯
      execution_path: List[str]                 # æ‰§è¡Œè·¯å¾„ï¼ˆè°ƒè¯•ç”¨ï¼‰
      question: str                             # ç”¨æˆ·é—®é¢˜
      timings: Dict[str, float]                 # å„èŠ‚ç‚¹æ‰§è¡Œæ—¶é—´
      retrieved_context: Optional[str]          # æ£€ç´¢ä¸Šä¸‹æ–‡
      llm_output: Optional[str]                 # LLM è¾“å‡º
      total: int                                 # æ£€ç´¢ç»“æœæ•°
      documents: List[Dict]                     # æ£€ç´¢æ–‡æ¡£
      scores: List[float]                        # ç›¸ä¼¼åº¦åˆ†æ•°
  ```

### 2. `nodes.py` - èŠ‚ç‚¹å®ç°

**èŒè´£**: å®ç°å„ç§å·¥ä½œæµèŠ‚ç‚¹çš„æ‰§è¡Œé€»è¾‘

**èŠ‚ç‚¹åŸºç±»**:
```python
class BaseNode:
    def __init__(self, node_id: str, config: Dict[str, Any])
    async def execute(self, state: WorkflowState) -> WorkflowState
```

**èŠ‚ç‚¹ç±»å‹**:
1. **InputNode**: æ¥æ”¶ç”¨æˆ·è¾“å…¥
2. **DataSourceNode**: æä¾›çŸ¥è¯†åº“åˆ—è¡¨
3. **RetrievalNode**: æ‰§è¡Œå‘é‡æ£€ç´¢
4. **LLMNode**: æ‰§è¡Œå¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆ
5. **ToolNode**: è°ƒç”¨ OpenWebUI Tools ç³»ç»Ÿ
6. **OutputNode**: æ ¼å¼åŒ–è¾“å‡º

### 3. `graph.py` - å›¾æ„å»ºå’Œæ‰§è¡Œ

**èŒè´£**: ä½¿ç”¨ LangGraph æ„å»ºå’Œæ‰§è¡Œå·¥ä½œæµå›¾

**æ ¸å¿ƒå‡½æ•°**:
- `create_workflow_graph()`: åˆ›å»ºå·¥ä½œæµå›¾
  - åˆ›å»ºèŠ‚ç‚¹å®ä¾‹
  - æ„å»ºè¿æ¥å…³ç³»ï¼ˆæ‹“æ‰‘æ’åºï¼‰
  - è®¾ç½®å…¥å£å’Œå‡ºå£èŠ‚ç‚¹
  - è¿”å› LangGraph StateGraph

- `execute_workflow()`: æ‰§è¡Œå·¥ä½œæµ
  - åˆ›å»ºå·¥ä½œæµå›¾
  - åˆå§‹åŒ–çŠ¶æ€
  - æ‰§è¡Œå›¾ï¼ˆä½¿ç”¨ `astream`ï¼‰
  - æå–æœ€ç»ˆç»“æœ

**çŠ¶æ€è½¬æ¢**:
- `WorkflowState` â†” `WorkflowGraphState` (LangGraph TypedDict æ ¼å¼)

---

## èŠ‚ç‚¹ç±»å‹

### InputNode (è¾“å…¥èŠ‚ç‚¹)

**ç±»å‹**: `"input"`

**è¾“å…¥**: æ— 

**è¾“å‡ºç«¯å£**: `user` (ç”¨æˆ·è¾“å…¥æ–‡æœ¬)

**é…ç½®**:
```python
{
    "user_input": "ç”¨æˆ·é—®é¢˜æ–‡æœ¬"
}
```

**åŠŸèƒ½**: æ¥æ”¶ç”¨æˆ·è¾“å…¥å¹¶å­˜å‚¨åˆ°çŠ¶æ€ä¸­

---

### DataSourceNode (æ•°æ®æºèŠ‚ç‚¹)

**ç±»å‹**: `"dataSource"`

**è¾“å…¥**: æ— ï¼ˆæˆ–é€šè¿‡ `input_bindings` ç»‘å®šï¼‰

**è¾“å‡ºç«¯å£**: `datasets` (çŸ¥è¯†åº“IDåˆ—è¡¨)

**é…ç½®**:
```python
{
    "selected_datasets": ["dataset_id_1", "dataset_id_2"],
    "input_bindings": {
        "datasets": "other_node.datasets"  # å¯é€‰ï¼šä»å…¶ä»–èŠ‚ç‚¹è·å–
    }
}
```

**åŠŸèƒ½**: æä¾›çŸ¥è¯†åº“IDåˆ—è¡¨ä¾›æ£€ç´¢èŠ‚ç‚¹ä½¿ç”¨

---

### RetrievalNode (æ£€ç´¢èŠ‚ç‚¹)

**ç±»å‹**: `"retrieval"`

**è¾“å…¥ç«¯å£**:
- `question`: æŸ¥è¯¢é—®é¢˜
- `datasets`: çŸ¥è¯†åº“åˆ—è¡¨

**è¾“å‡ºç«¯å£**:
- `context`: æ‹¼æ¥çš„ä¸Šä¸‹æ–‡æ–‡æœ¬
- `retrieval_result`: å®Œæ•´æ£€ç´¢ç»“æœï¼ˆJSONï¼‰

**é…ç½®**:
```python
{
    "top_k": 5,                          # æ£€ç´¢æ•°é‡
    "similarity_threshold": 0.7,         # ç›¸ä¼¼åº¦é˜ˆå€¼
    "vector_similarity_weight": 0.3,     # å‘é‡ç›¸ä¼¼åº¦æƒé‡
    "keyword": True,                     # æ˜¯å¦å¯ç”¨å…³é”®è¯åŒ¹é…
    "highlight": False,                  # æ˜¯å¦é«˜äº®
    "context_top_k": 3,                   # ä¸Šä¸‹æ–‡ä½¿ç”¨çš„ top_k
    "context_max_chars": 2000,           # ä¸Šä¸‹æ–‡æœ€å¤§å­—ç¬¦æ•°
    "context_include_source": True,      # æ˜¯å¦åŒ…å«æ¥æº
    "context_include_score": False,      # æ˜¯å¦åŒ…å«åˆ†æ•°
    "context_use_highlight": False,     # æ˜¯å¦ä½¿ç”¨é«˜äº®
    "context_join": "\n---\n",           # ä¸Šä¸‹æ–‡åˆ†éš”ç¬¦
    "input_bindings": {
        "question": "input_1.user",
        "datasets": "dataSource_1.datasets"
    }
}
```

**åŠŸèƒ½**: 
- è°ƒç”¨ RAGFlow æ£€ç´¢æœåŠ¡
- ç»„è£…æ£€ç´¢ä¸Šä¸‹æ–‡
- å­˜å‚¨æ£€ç´¢ç»“æœåˆ°çŠ¶æ€

---

### LLMNode (LLMèŠ‚ç‚¹)

**ç±»å‹**: `"llm"`

**è¾“å…¥ç«¯å£**:
- `question`: é—®é¢˜
- `context`: ä¸Šä¸‹æ–‡

**è¾“å‡ºç«¯å£**: `answer` (LLMç”Ÿæˆçš„å›ç­”)

**é…ç½®**:
```python
{
    "model": "gpt-4",                    # æ¨¡å‹ID
    "temperature": 0.7,                  # æ¸©åº¦å‚æ•°
    "max_tokens": 2000,                  # æœ€å¤§tokenæ•°
    "prompt_template": "é—®é¢˜: {question}\nä¸Šä¸‹æ–‡:\n{retrieved_context}",
    "input_bindings": {
        "question": "input_1.user",
        "context": "retrieval_1.context"
    }
}
```

**åŠŸèƒ½**:
- æ¸²æŸ“æç¤ºè¯æ¨¡æ¿
- è°ƒç”¨ LLM æœåŠ¡ï¼ˆ`generate_chat_completion_internal`ï¼‰
- å­˜å‚¨ç”Ÿæˆç»“æœ

---

### ToolNode (å·¥å…·èŠ‚ç‚¹)

**ç±»å‹**: `"tool"`

**è¾“å…¥ç«¯å£**: `params` (å·¥å…·å‚æ•°ï¼ŒJSON å­—ç¬¦ä¸²æˆ–å¯¹è±¡)

**è¾“å‡ºç«¯å£**:
- `result`: å·¥å…·æ‰§è¡Œç»“æœ
- `error`: é”™è¯¯ä¿¡æ¯

**é…ç½®**:
```python
{
    "tool_id": "your_tool_id",           # å·¥å…·IDï¼ˆå¿…éœ€ï¼‰
    "tool_name": "your_function_name",   # å·¥å…·å‡½æ•°åï¼ˆå¯é€‰ï¼‰
    "tool_params": {                      # å·¥å…·å‚æ•°
        "param1": "value1",
        "param2": "value2"
    },
    "input_bindings": {
        "params": "llm_1.answer"  # ä»ä¸Šæ¸¸èŠ‚ç‚¹è·å–å‚æ•°
    }
}
```

**åŠŸèƒ½**:
- è°ƒç”¨ OpenWebUI Tools ç³»ç»Ÿä¸­çš„å·¥å…·
- æ”¯æŒé€šè¿‡ `input_bindings` ä»ä¸Šæ¸¸èŠ‚ç‚¹è·å–å‚æ•°
- éœ€è¦ `request` å’Œ `user` å‚æ•°ï¼ˆä» `execute_workflow` ä¼ å…¥ï¼‰

**æ³¨æ„äº‹é¡¹**:
- æ‰§è¡Œå·¥ä½œæµæ—¶å¿…é¡»ä¼ å…¥ `request` å’Œ `user` å‚æ•°
- å·¥å…·æ‰§è¡Œç»“æœå­˜å‚¨åœ¨ `state.messages[node_id]["result"]` ä¸­
- é”™è¯¯ä¿¡æ¯åœ¨ `state.messages[node_id]["error"]` ä¸­

---

### OutputNode (è¾“å‡ºèŠ‚ç‚¹)

**ç±»å‹**: `"output"`

**è¾“å…¥ç«¯å£**: `answer` (LLMå›ç­”)

**è¾“å‡ºç«¯å£**: `output` (æœ€ç»ˆè¾“å‡º)

**é…ç½®**:
```python
{
    "format": "text",  # è¾“å‡ºæ ¼å¼
    "input_bindings": {
        "answer": "llm_1.answer"
    }
}
```

**åŠŸèƒ½**: æ ¼å¼åŒ–å¹¶è¾“å‡ºæœ€ç»ˆç»“æœ

---

## æ•°æ®æµ

### æ¶ˆæ¯ä¼ é€’æœºåˆ¶

èŠ‚ç‚¹é—´é€šè¿‡ `state.messages` ä¼ é€’æ•°æ®ï¼š

```
state.messages = {
    "input_1": {
        "user": Message(type="user", payload="ç”¨æˆ·é—®é¢˜")
    },
    "dataSource_1": {
        "datasets": Message(type="json", payload=["dataset_id_1"])
    },
    "retrieval_1": {
        "context": Message(type="context", payload="æ£€ç´¢ä¸Šä¸‹æ–‡..."),
        "retrieval_result": Message(type="json", payload={...})
    },
    "llm_1": {
        "answer": Message(type="text", payload="LLMå›ç­”...")
    }
}
```

### ç«¯å£ç»‘å®š (Port Bindings)

ä½¿ç”¨ `input_bindings` ç²¾ç¡®æ§åˆ¶æ•°æ®æµï¼š

```python
{
    "input_bindings": {
        "question": "input_1.user",        # ä» input_1 çš„ user ç«¯å£è·å–
        "context": "retrieval_1.context"  # ä» retrieval_1 çš„ context ç«¯å£è·å–
    }
}
```

### è¿æ¥å…³ç³»

é€šè¿‡ `connections` å®šä¹‰èŠ‚ç‚¹é—´çš„è¿æ¥ï¼š

```python
connections = [
    {
        "from": "input_1",
        "to": "retrieval_1",
        "type": "unidirectional"
    },
    {
        "from": "dataSource_1",
        "to": "retrieval_1",
        "type": "unidirectional"
    }
]
```

---

## API æ¥å£

### è·¯ç”±ç»“æ„

```
/api/v1/agent/
â”œâ”€â”€ /                    # Agent ä¿¡æ¯ï¼ˆå ä½ï¼‰
â”œâ”€â”€ /retrieval/          # æ£€ç´¢ç›¸å…³ API
â”‚   â”œâ”€â”€ /datasets        # è·å– RAGFlow datasets åˆ—è¡¨
â”‚   â””â”€â”€ /                # RAGFlow æ£€ç´¢
â””â”€â”€ /rag/                # RAG ç›¸å…³ API
    â””â”€â”€ /migrate/excel   # Excel è¿ç§»åˆ° RAGFlow
```

### ä¸»è¦æ¥å£

#### 1. è·å– RAGFlow Datasets

```http
GET /api/v1/agent/retrieval/datasets
```

**å“åº”**:
```json
{
    "code": 0,
    "data": [
        {
            "id": "dataset_id",
            "name": "æ•°æ®é›†åç§°",
            ...
        }
    ]
}
```

#### 2. RAGFlow æ£€ç´¢

```http
POST /api/v1/agent/retrieval
```

**è¯·æ±‚ä½“**:
```json
{
    "question": "ç”¨æˆ·é—®é¢˜",
    "dataset_ids": ["dataset_id_1"],
    "top_k": 5,
    "similarity_threshold": 0.7
}
```

**å“åº”**:
```json
{
    "code": 0,
    "data": {
        "documents": [...],
        "scores": [...],
        "total": 10
    }
}
```

---

## å‰ç«¯é›†æˆ

### ç»„ä»¶ç»“æ„

```
src/
â”œâ”€â”€ routes/(app)/workspace/agent/
â”‚   â””â”€â”€ +page.svelte          # Agent é¡µé¢è·¯ç”±
â”œâ”€â”€ lib/components/workspace/
â”‚   â””â”€â”€ Agent.svelte           # Agent ç»„ä»¶ï¼ˆå ä½ï¼‰
â””â”€â”€ lib/apis/agent/
    â””â”€â”€ index.ts               # Agent API å®¢æˆ·ç«¯
```

### API å®¢æˆ·ç«¯

```typescript
// src/lib/apis/agent/index.ts
export class AgentAPIClient {
    private baseUrl = `${WEBUI_API_BASE_URL}/agent`;
    
    async ragflowListDatasets(): Promise<RagFlowDatasetsResponse>
    async ragflowRetrieval(req: RagFlowRetrievalRequest): Promise<RagFlowRetrievalResponse>
}

export const agentAPI = new AgentAPIClient();
```

### è·¯ç”±é…ç½®

å·¥ä½œç©ºé—´å¸ƒå±€ (`src/routes/(app)/workspace/+layout.svelte`) ä¸­å·²æ·»åŠ  Agent é¢æ¿å¯¼èˆªï¼š

```svelte
{#if $user?.role === 'admin'}
    <a href="/workspace/agent">Agent</a>
{/if}
```

---

## æ‰©å±•è®¡åˆ’

### å·²å®Œæˆ âœ…
- [x] åŸºç¡€èŠ‚ç‚¹å®ç°ï¼ˆInput, DataSource, Retrieval, LLM, Outputï¼‰
- [x] å·¥å…·èŠ‚ç‚¹é›†æˆï¼ˆToolNodeï¼‰
- [x] çŠ¶æ€ç®¡ç†å’Œæ¶ˆæ¯ä¼ é€’
- [x] LangGraph å›¾æ‰§è¡Œ
- [x] ç«¯å£ç»‘å®šæœºåˆ¶
- [x] æ—¶é—´ç»Ÿè®¡å’Œè°ƒè¯•æ”¯æŒ

### è¿›è¡Œä¸­ ğŸ”„
- [ ] å‰ç«¯ UI å¼€å‘ï¼ˆAgent.svelteï¼‰
- [ ] å·¥ä½œæµå¯è§†åŒ–ç¼–è¾‘å™¨
- [ ] å·¥ä½œæµä¿å­˜/åŠ è½½

### è§„åˆ’ä¸­ ğŸ“‹
- [ ] æ¡ä»¶è·¯ç”±ï¼ˆæ ¹æ® LLM è¾“å‡ºå†³å®šæ˜¯å¦æ£€ç´¢ï¼‰
- [ ] å¾ªç¯æ‰§è¡Œï¼ˆæ£€ç´¢ â†’ LLM â†’ æ£€ç´¢çš„è¿­ä»£ä¼˜åŒ–ï¼‰
- [ ] å¹¶è¡Œæ‰§è¡Œï¼ˆå¤šä¸ªæ£€ç´¢èŠ‚ç‚¹åŒæ—¶æ‰§è¡Œï¼‰
- [ ] å·¥å…·é“¾ï¼ˆå·¥å…· â†’ LLM â†’ å·¥å…·çš„å¾ªç¯è°ƒç”¨ï¼‰
- [ ] æ£€æŸ¥ç‚¹å’Œæ¢å¤ï¼ˆæ”¯æŒå·¥ä½œæµä¸­æ–­åæ¢å¤ï¼‰
- [ ] å¯è§†åŒ–è°ƒè¯•ï¼ˆç”Ÿæˆæ‰§è¡Œå›¾ï¼‰
- [ ] å·¥ä½œæµæ¨¡æ¿åº“
- [ ] æ‰¹é‡æ‰§è¡Œæ”¯æŒ

---

## æŠ€æœ¯æ ˆ

- **åç«¯**: Python 3.11+, FastAPI, LangGraph
- **å‰ç«¯**: SvelteKit, TypeScript
- **çŠ¶æ€ç®¡ç†**: LangGraph StateGraph, Pydantic
- **å¤–éƒ¨æœåŠ¡**: RAGFlow, OpenAI/æœ¬åœ° LLM, OpenWebUI Tools

---

## ç›¸å…³æ–‡ä»¶

### åç«¯
- `backend/open_webui/agent/` - æ ¸å¿ƒæ¨¡å—
- `backend/open_webui/routers/agent.py` - API è·¯ç”±
- `backend/open_webui/main.py` - è·¯ç”±æ³¨å†Œ

### å‰ç«¯
- `src/routes/(app)/workspace/agent/+page.svelte` - Agent é¡µé¢
- `src/lib/components/workspace/Agent.svelte` - Agent ç»„ä»¶
- `src/lib/apis/agent/index.ts` - API å®¢æˆ·ç«¯

---

## ä½¿ç”¨ç¤ºä¾‹

å‚è§ `backend/open_webui/agent/README.md` ä¸­çš„è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹ã€‚

---

**æœ€åæ›´æ–°**: 2025-11-05

